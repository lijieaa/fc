<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jianpanmao.dataStatistics.dao.DataStatisticsMapper">

    <!--中间商设备数排名-->
  <select id="intermediaryDeviceCount" resultType="java.util.HashMap">
SELECT COUNT(d.device_id) count,
 i.intermediary_name
 from device d
 RIGHT JOIN intermediary i
 on d.intermediary_id = i.intermediary_id
GROUP BY i.intermediary_name
ORDER BY count DESC
  </select>

    <!--中间商地势分布占比-->
    <select id="intermediaryArea" resultType="java.util.HashMap">
        SELECT
COUNT(i.intermediary_id),
a.name
FROM intermediary i
LEFT JOIN area a
ON i.area_id  = a.ID
GROUP BY a.name
    </select>

    <!--各地市项目占比情况-->
    <select id="deviceArea" resultType="java.util.HashMap">
        SELECT
COUNT(p.project_id),
a.`NAME`
FROM project p
LEFT JOIN area a
ON p.area_id = a.ID
WHERE p.project_status = 1
GROUP BY a.name
    </select>

    <!--近五年中间商设备趋势-->
    <!--中间商-->
    <select id="intermediary" resultType="java.util.HashMap">
select
DATE_FORMAT(i.intermediary_create_time,'%Y') year,
COUNT(i.intermediary_id) count
FROM
intermediary i
WHERE i.is_plat = 0
AND  DATE_FORMAT(i.intermediary_create_time,'%Y') > DATE_FORMAT(DATE_ADD(NOW(),INTERVAL -5 YEAR),'%Y')
GROUP BY intermediaryYear
    </select>
    <!--设备-->
    <select id="device" resultType="java.util.HashMap">
SELECT
DATE_FORMAT(d.device_create_time,'%Y') year,
COUNT(d.device_id) count
FROM device d
WHERE d.valid = 0
AND DATE_FORMAT(d.device_create_time,'%Y') > DATE_FORMAT(DATE_ADD(NOW(),INTERVAL -5 YEAR),'%Y')
GROUP BY deviceYear
    </select>
</mapper>