<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
    <style>
        .form-actions{
            overflow: hidden;
        }
    </style>
</head>
<body layout:fragment="content">
<div class="page-header">
    <h1>
        添加设备
        <small>
            <!--<i class="ace-icon fa fa-angle-double-right"></i>-->
            <!--Static &amp; Dynamic Tables-->
        </small>
    </h1>
</div>
<div class="row" id="deviceAdd">
    <div class="col-xs-12">
        <div class="row">
            <!--<form class="" id="">-->
                <div class="form-group" style="overflow: hidden">
                    <label class="control-label col-xs-12 col-sm-1 no-padding-right" for="Num">扫描编号:</label>
                    <div class="col-xs-12 col-sm-11">
                        <div class="clearfix">
                            <input type="text" id="Num"  class="col-xs-12 col-sm-6"  v-on:change="changeNum($event)">
                        </div>
                    </div>
                </div>
            <!--</form>-->
            <div class="col-xs-12 col-sm-12 widget-container-col" id="widget-container-col-2">
                <div class="widget-box widget-color-blue" id="widget-box-2">
                    <div class="widget-body">
                        <div class="widget-main no-padding">
                            <table class="table table-striped table-bordered table-hover" id="deviceAddList">
                                <thead class="thin-border-bottom">
                                <tr>
                                    <th>选择</th>
                                    <th>生产编号</th>
                                </tr>
                                </thead>
                                <tbody>
                                <template v-for="item in tableList">
                                    <tr>
                                        <td class="">
                                            <label class="pos-rel">
                                                <input type="checkbox" class="ace" >
                                                <span class="lbl"></span>
                                            </label>
                                        </td>
                                        <td>
                                            <span>{{item}}</span>
                                        </td>
                                    </tr>
                                </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix form-actions">
                <div class="col-md-offset-3 col-md-9">
                    <button type="button" @click="addNum" class="btn btn-info">确定</button>
                    <button type="reset" @click="resetNum" class="btn">重置</button>
                </div>
            </div>
        </div>
        <!-- PAGE CONTENT ENDS -->
    </div>
    <!-- /.col -->
</div>
<script type="text/javascript" th:inline="javascript">
    jQuery(function($) {
        new Vue({
            el:"#deviceAdd",
            data:{
                checked:true,
                dataList:[],
                tableList:[],
                idArr:[],
                deviceProductionNum:[]
            },
            methods:{
                changeNum:function (item) {
                    console.log($("#Num").val());
                    if($("#Num").val().trim() == ""){
                        return false;
                    }
                    this.dataList.push($.trim($("#Num").val()));
                    $("#Num").val("").focus();
                    var arr =new Set(this.dataList);
                    this.tableList = Array.from(arr);
                },
                addNum:function(){
                    var _this = this;
                    _this.deviceProductionNum = [];
                    $("#deviceAddList td input[type=checkbox]").each(function(i,item){
                        if(item.checked == true){
                            _this.idArr.push($(item).parents("td").siblings("td").find("span").text());
                        }
                    });
                   for(var i=0;i<_this.idArr.length;i++){
                       var data ={
                           deviceProductionNum:_this.idArr[i]
                       };
                       _this.deviceProductionNum.push(data);
                   }
                   if( _this.deviceProductionNum.length == 0){
                       bootbox.alert("请选择生产编号");
                       return false;
                   }
                    $.ajax({
                        url:contextPath+"api/device",
                        method:"post",
                        contentType: "application/json",
                        dataType : "json",
                        data:JSON.stringify(_this.deviceProductionNum),
                        success:function(data){
                            if(data.status == 200){
                                window.location.href = contextPath +"device/list?mid=1"
                            }
                        }
                    })

                },
                resetNum:function(){
                    $("#deviceAddList td input[type=checkbox]").each(function(i,item){
                        item.checked = false;
                    });
                }
            },
            mounted:function () {
                $("#Num").focus();
                $('#deviceAddList').on('click', 'td input[type=checkbox]' , function(){
                    // var row = $(this).closest('tr').get(0);
                    console.log(this.checked);
                    // if(this.checked) myTable.row(row).deselect();
                    // else myTable.row(row).select();
                });
            }
        })
    })
</script>
</body>
</html>