<!DOCTYPE html>
<html class="">
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#2196f3">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap:">
    <title>设备列表</title>
    <link rel="stylesheet" th:href="@{/css/framework7.min.css}">
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <link rel="stylesheet" th:href="@{/css/cover.css}">
    <script th:inline="javascript">
        var deviceWidth = document.documentElement.clientWidth;
        if(deviceWidth > 1080) deviceWidth = 1080;
        document.documentElement.style.fontSize = deviceWidth / 10.8 + 'px';
        var contextPath = /*[[@{/}]]*/;
        var ip = /*[[${#request.getLocalAddr()}]]*/;
        var port = /*[[${#request.getLocalPort()}]]*/;
        var scheme=/*[[${#request.getScheme()}]]*/;
        var serverName=/*[[${#request.getServerName()}]]*/;
        var port=/*[[${#request.getServerPort()}]]*/;
        var absolutePath = scheme+"://"+serverName+":"+port;
        var imgPath=absolutePath+"/uploadimg/"
        var id = [[${id}]];
        alert(id);
    </script>
    <script th:src="@{/js/framework7.min.js}"></script>
    <script th:src="@{/ace/assets/js/jquery-2.1.4.min.js}"></script>
</head>
<body>
<div id="app" class="wrapper framework7-root">
    <div class="statusbar"></div>

    <div class="view view-main view-init ios-edges" >
        <div class="navbar" style="background:#ffffff;">
            <div class="navbar-inner" style="background:#efeff4;">
                <form class="searchbar">
                    <div class="searchbar-inner"  style="background:none;">
                        <div style="flex-shrink:0" >
                            <select name="" id="" class="pkee text-base-color f30 bdr-clr"  style="width:100px">
                                <option value="">生产编号</option>
                               <!-- <option value="">所属项目</option>
                                <option value="">操作员</option>
                                <option value="">抄表员</option>-->
                            </select>
                        </div>
                      <!--  <i class=" ser-btn  text-base-color f7-icons f32"  style="width:20px">&or;</i>-->

                        <div class="ser-box">
                            <input type="search" placeholder="" id="serch" class="f28">
                            <i class="searchbar-icon"></i>
                        </div>
                        <span  id="ser-btn" class="ser-btn text-base-color f30 bdr-clr" >搜索</span>
                    </div>
                </form>

                <div class="subnavbar" style="top:100%;display: block;background:#ffffff;height:30px">
                    <div class="subnavbar-inner" style="padding:0 ">
                        <div class="subnavbar-inner f32 fw text-base-color" >广西东泉湖智能生态环境建设工程</div>
                    </div>

                </div>
            </div>

        </div>
        <div class="pages">

            <div class="page" data-page="home">

                <div class="page-content infinite-scroll-content">

                    <div class="list  links-list media-list ">
                        <ul id="listview">
        <!--                    <li class="plist card">
                                <a class="item-content external" href="/wx/common/operate">
                                    <div class="item-inner ">
                                        <div class="item-title-row">
                                            <div  class="item-title f32">生产编号：1235184531</div>
                                        </div>

                                        <div class="item-text ">
                                            <table>
                                                <colgroup>
                                                    <col width="50%"/>
                                                    <col width="50%"/>
                                                </colgroup>
                                                <tr><td><span>操作员：</span>张图强</td><td><span>型号：</span>FGGD_1</td></tr>
                                                <tr><td><span>抄表员：</span>李四</td><td><span>状态：</span><span class="cstatus">不在线</span></td></tr>
                                            </table>

                                        </div>

                                    </div>
                                </a>
                            </li>
                            <li class="plist card">
                                <a class="item-content external" href="/wx/common/operate">
                                    <div class="item-inner ">
                                        <div class="item-title-row">
                                            <div  class="item-title f32">生产编号：1235184531</div>
                                        </div>

                                        <div class="item-text ">
                                            <table>
                                                <colgroup>
                                                    <col width="50%"/>
                                                    <col width="50%"/>
                                                </colgroup>
                                                <tr><td><span>操作员：</span>张图强</td><td><span>型号：</span>FGGD_1</td></tr>
                                                <tr><td><span>抄表员：</span>李四</td><td><span>状态：</span><span class="cstatus">不在线</span></td></tr>
                                            </table>

                                        </div>

                                    </div>
                                </a>
                            </li>
                            <li class="plist card">
                                <a class="item-content external" href="/wx/common/operate">
                                    <div class="item-inner ">
                                        <div class="item-title-row">
                                            <div  class="item-title f32">生产编号：1235184531</div>
                                        </div>

                                        <div class="item-text ">
                                            <table>
                                                <colgroup>
                                                    <col width="50%"/>
                                                    <col width="50%"/>
                                                </colgroup>
                                                <tr><td><span>操作员：</span>张图强</td><td><span>型号：</span>FGGD_1</td></tr>
                                                <tr><td><span>抄表员：</span>李四</td><td><span>状态：</span><span class="cstatus">不在线</span></td></tr>
                                            </table>

                                        </div>

                                    </div>
                                </a>
                            </li>
                            <li class="plist card">
                                <a class="item-content external" href="/wx/common/operate">
                                    <div class="item-inner ">
                                        <div class="item-title-row">
                                            <div  class="item-title f32">生产编号：1235184531</div>
                                        </div>

                                        <div class="item-text ">
                                            <table>
                                                <colgroup>
                                                    <col width="50%"/>
                                                    <col width="50%"/>
                                                </colgroup>
                                                <tr><td><span>操作员：</span>张图强</td><td><span>型号：</span>FGGD_1</td></tr>
                                                <tr><td><span>抄表员：</span>李四</td><td><span>状态：</span><span class="cstatus">不在线</span></td></tr>
                                            </table>

                                        </div>

                                    </div>
                                </a>
                            </li>
                            <li class="plist card">
                                <a class="item-content external" href="/wx/common/operate">
                                    <div class="item-inner ">
                                        <div class="item-title-row">
                                            <div  class="item-title f32">生产编号：1235184531</div>
                                        </div>

                                        <div class="item-text ">
                                            <table>
                                                <colgroup>
                                                    <col width="50%"/>
                                                    <col width="50%"/>
                                                </colgroup>
                                                <tr><td><span>操作员：</span>张图强</td><td><span>型号：</span>FGGD_1</td></tr>
                                                <tr><td><span>抄表员：</span>李四</td><td><span>状态：</span><span class="cstatus">不在线</span></td></tr>
                                            </table>

                                        </div>

                                    </div>
                                </a>
                            </li>
                            <li class="plist card">
                                <a class="item-content external" href="/wx/common/equipment">
                                    <div class="item-inner ">
                                        <div class="item-title-row">
                                            <div  class="item-title f32">生产编号：1235184531</div>
                                        </div>

                                        <div class="item-text ">
                                            <table>
                                                <colgroup>
                                                    <col width="50%"/>
                                                    <col width="50%"/>
                                                </colgroup>
                                                <tr><td><span>操作员：</span>张图强</td><td><span>型号：</span>FGGD_1</td></tr>
                                                <tr><td><span>抄表员：</span>李四</td><td><span>状态：</span><span class="cstatus">不在线</span></td></tr>
                                            </table>

                                        </div>

                                    </div>
                                </a>
                            </li>
                            <li class="plist card">
                                <a class="item-content external" href="/wx/common/equipment">
                                    <div class="item-inner ">
                                        <div class="item-title-row">
                                            <div  class="item-title f32">生产编号：1235184531</div>
                                        </div>

                                        <div class="item-text ">
                                            <table>
                                                <colgroup>
                                                    <col width="50%"/>
                                                    <col width="50%"/>
                                                </colgroup>
                                                <tr><td><span>操作员：</span>张图强</td><td><span>型号：</span>FGGD_1</td></tr>
                                                <tr><td><span>抄表员：</span>李四</td><td><span>状态：</span><span class="cstatus">不在线</span></td></tr>
                                            </table>

                                        </div>

                                    </div>
                                </a>
                            </li>
                            <li class="plist card">
                                <a class="item-content external" href="/wx/common/equipment">
                                    <div class="item-inner ">
                                        <div class="item-title-row">
                                            <div  class="item-title f32">生产编号：1235184531</div>
                                        </div>

                                        <div class="item-text ">
                                            <table>
                                                <colgroup>
                                                    <col width="50%"/>
                                                    <col width="50%"/>
                                                </colgroup>
                                                <tr><td><span>操作员：</span>张图强</td><td><span>型号：</span>FGGD_1</td></tr>
                                                <tr><td><span>抄表员：</span>李四</td><td><span>状态：</span><span class="cstatus">不在线</span></td></tr>
                                            </table>

                                        </div>

                                    </div>
                                </a>
                            </li>-->
                        </ul>
                    </div>
                    <div class="preloader infinite-scroll-preloader"></div>
                </div>

            </div>
            <!-- <div class="toolbar tabbar">
                 <div class="toolbar-inner">

                 </div>
         </div>-->
        </div>
    </div>
</div>

<script type="text/javascript"  th:inline="javascript">
    var sourceId = [[${sourceId}]];
    sourceId =sourceId||'gh_f5a46974c0f6';
    var $$ = Dom7;
    // Loading flag
    var allowInfinite = true;
    // Last loaded index
    var lastItemIndex = -1;
    var maxItems = 0;
    // Max items to load
    // Append items per load
    var itemsPerLoad = 8;
    var pageNum=1;
    var app = new Framework7({
        id: 'io.framework7.testapp',
        root: '#app',
        theme: "ios",
        data: function () {
            return {
                allowInfinite: true,
                lastItem: 20,
            }
        },
        overlay:false,
        on:{
            init:function(page){
                initList()
            }
        }

    });
    app.infiniteScroll.create(".infinite-scroll-content")
    var $$ = Dom7;

    // Loading flag
    var allowInfinite = true;

    // Last loaded index
    var lastItemIndex = $$('.list li').length;

    // Max items to load
    var maxItems = 200;

    // Append items per load
    var itemsPerLoad = 20;

    // Attach 'infinite' event handler
    function serch(){
        maxItems = 0;
        pageNum=1;
        $('.list li').remove()
        initList()
    }

    function initList(){
        allowInfinite = false;
        console.log(lastItemIndex,maxItems)
        var  deviceProductionNum= $("#serch").val()

        $.ajax({
            url: "/wd/devices",
            type:"get",
            data:{
                sourceId:sourceId,
                pageNum:pageNum,
                pageSize:itemsPerLoad,
                deviceProductionNum:deviceProductionNum

            },
            success:function(data){
                allowInfinite = true;
                console.log(data)
                var html = '';
                if(data.status==200){
                    maxItems = data.content.total
                    data.content.list.forEach(function(item,i){
                        console.log(item)

                        var status ="未知"
                        switch(item.deviceStatus){
                            case  0: status="在线";break;
                            case 1: status="离线";break;
                            default: status="未知";
                        }
                        html +=    '<li class="plist card">'+
                                '<a class="item-content external"   href="/wd/operate?equipnum='+item.deviceProductionNum+'">'+
                                '<div class="item-inner ">'+
                                '<div class="item-title-row">'+
                                '<div class="item-title f32">生产编号：'+item.deviceProductionNum+'</div>'+
                                '</div>'+
                                '<div class="item-text ">'+
                                '<table>'+
                                '<colgroup>'+
                                '<col width="50%"/>'+
                                '<col width="50%"/>'+
                                '</colgroup>'+
                                '<tr><td><span>操作员：</span>'+(item.operateUserStr)+'</td><td><span>型号：</span>'+item.deviceType+'</td></tr>'+
                                ' <tr><td><span>抄表员：</span>'+(item.transcribeUserStr)+'</td><td><span>状态：</span><span class="cstatus">'+status+'</span></td></tr>'+
                                '</table>'+
                                '</div></div></a> </li>'
                    })
                    $$('#listview').append(html);
                    lastItemIndex = $$('.list li').length;
                    pageNum++;

                    if (lastItemIndex >= maxItems) {
                        // Nothing more to load, detach infinite scroll events to prevent unnecessary loadings
                        app.infiniteScroll.destroy('.infinite-scroll-content');
                        // Remove preloader
                        $$('.infinite-scroll-preloader').remove();
                        return;
                    }
                }









            }
        })
    }

    $$("#ser-btn").on("click",function(){
        maxItems = 0;
        pageNum=1;
        console.log($("#serch").val())
        $('.list li').remove()
        initList()
    })
    $$('.infinite-scroll-content').on('infinite', function () {
        // Exit, if loading in progress
        if (!allowInfinite) return;

        // Set loading flag
        allowInfinite = false;

        // Emulate 1s loading
        initList()
    });
</script>

</body>
</html>