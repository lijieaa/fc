<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
    <link rel="stylesheet" th:href="@{/css/index.css}"/>
</head>
<body layout:fragment="content">
<section class="map-container">
    <div id="container"></div>
</section>



<script type="text/javascript" src='//webapi.amap.com/maps?v=1.4.6&key=bc060e817772642394bf876bedc8a8bc'></script>
<!-- UI组件库 1.0 -->
<script src="//webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>
<script type="text/javascript" th:inline="javascript">
    //创建地图
    var map = new AMap.Map('container', {
        zoom: 5,
        center: [116.397428, 39.90923]
    });

    $(function () {
        $("#container").css("height", $("body").height());
        $.ajax({
            async : false,
            cache:false,
            type: 'get',
            dataType : "json",
            url: contextPath + "api/device/homePageDevice",
            success:function(data){
                if (data.status == "200") {
                    console.log(data);
                    if (data.content.length) {
                        $.each(data.content, function (i, item) {
                            //加载SimpleMarker
                            AMapUI.loadUI(['overlay/SimpleMarker'], function(SimpleMarker) {
//                                map.lnglatToPixel(map.getCenter());
                                var iconTheme = 'default';
                                //内置的样式
//                                var iconStyles = SimpleMarker.getBuiltInIconStyles(iconTheme);
                                new SimpleMarker({
//                                    iconTheme: iconTheme,
                                    //使用内置的iconStyle
//                                    iconStyle: iconStyles[i],
                                    iconStyle: {
                                        src: 'images/map-icon.png',
                                        style: {
                                            width: '20px',
                                            height: '30px'
                                        }
                                    },
                                    //图标文字
                                    /*iconLabel: {
                                        //A,B,C.....
                                        innerHTML: String.fromCharCode('A'.charCodeAt(0) + i),
                                        style: {
                                            //颜色, #333, red等等，这里仅作示例，取iconStyle中首尾相对的颜色
                                            color: iconStyles[data.content.length - 1 - i]
                                        }
                                    },*/
                                    map: map,
                                    position: [item.deviceLocationX, item.deviceLocationY],

                                    //Marker的label(见http://lbs.amap.com/api/javascript-api/reference/overlay/#Marker)
                                    label: {
                                        content: item.deviceProductionNum,
                                        offset: new AMap.Pixel(24, 5)
                                    }
                                });

                            });
                        })
                    }
                }
            },
            error: function () {
                alert('获取设备信息失败');
            }
        });
    });
</script>
</body>
</html>